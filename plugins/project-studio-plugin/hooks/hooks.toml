# Project Studio Hooks
# Automated validation and formatting for project artifacts

# =============================================================================
# SECURITY HOOKS (PreToolUse) - Deterministic enforcement
# These hooks BLOCK dangerous operations. CLAUDE.md rules can be ignored
# under context pressure, but hooks always execute.
# =============================================================================

# Block access to sensitive files (.env, secrets, credentials, keys)
[[hooks]]
event = "PreToolUse"
tools = ["Read", "Edit", "Write"]
matcher = { type = "file_path", pattern = "**/.env*" }
command = "bash hooks/block-secrets.sh"

[[hooks]]
event = "PreToolUse"
tools = ["Read", "Edit", "Write"]
matcher = { type = "file_path", pattern = "**/secrets.json" }
command = "bash hooks/block-secrets.sh"

[[hooks]]
event = "PreToolUse"
tools = ["Read", "Edit", "Write"]
matcher = { type = "file_path", pattern = "**/credentials.json" }
command = "bash hooks/block-secrets.sh"

[[hooks]]
event = "PreToolUse"
tools = ["Read", "Edit", "Write"]
matcher = { type = "file_path", pattern = "**/*.pem" }
command = "bash hooks/block-secrets.sh"

[[hooks]]
event = "PreToolUse"
tools = ["Read", "Edit", "Write"]
matcher = { type = "file_path", pattern = "**/*.key" }
command = "bash hooks/block-secrets.sh"

[[hooks]]
event = "PreToolUse"
tools = ["Read", "Edit", "Write"]
matcher = { type = "file_path", pattern = "**/id_rsa*" }
command = "bash hooks/block-secrets.sh"

[[hooks]]
event = "PreToolUse"
tools = ["Read", "Edit", "Write"]
matcher = { type = "file_path", pattern = "**/id_ed25519*" }
command = "bash hooks/block-secrets.sh"

# Block dangerous shell commands (force push, hard reset, rm -rf, etc.)
[[hooks]]
event = "PreToolUse"
tools = ["Bash"]
command = "bash hooks/block-dangerous-commands.sh"

# =============================================================================
# VALIDATION HOOKS (PostToolUse) - Document structure validation
# =============================================================================

# Validate PRD structure after creation/edit
[[hooks]]
event = "PostToolUse"
tools = ["Write", "Edit"]
matcher = { type = "file_path", pattern = "**/PRODUCT_PRD.md" }
command = "bash hooks/validate-prd.sh"

# Validate Feature PRD story sizing
[[hooks]]
event = "PostToolUse"
tools = ["Write", "Edit"]
matcher = { type = "file_path", pattern = "**/features/*/PRD.md" }
command = "bash hooks/validate-feature-prd.sh"

# Initialize progress.txt when Feature PRD is created
[[hooks]]
event = "PostToolUse"
tools = ["Write"]
matcher = { type = "file_path", pattern = "**/features/*/PRD.md" }
command = "bash hooks/init-progress.sh"

# Validate architecture document has required sections
[[hooks]]
event = "PostToolUse"
tools = ["Write", "Edit"]
matcher = { type = "file_path", pattern = "**/ARCHITECTURE.md" }
command = "bash hooks/validate-architecture.sh"

# Validate design document has required sections
[[hooks]]
event = "PostToolUse"
tools = ["Write", "Edit"]
matcher = { type = "file_path", pattern = "**/DESIGN.md" }
command = "bash hooks/validate-design.sh"

# Auto-format YAML files
[[hooks]]
event = "PostToolUse"
tools = ["Write", "Edit"]
matcher = { type = "file_extension", extensions = [".yaml", ".yml"] }
command = "npx prettier --write"

# Reminder to run gate-check after phase artifacts complete
[[hooks]]
event = "Stop"
tools = []
command = "bash hooks/suggest-gate-check.sh"
